pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
function _init()
 x,y=32,24
 w,h=7,7
end

function hita(x,y,w,h,f)
 if (f==nil) f=1
 lu=fget(mget( x   /8, y   /8))
 ld=fget(mget( x   /8,(y+h)/8))
 ru=fget(mget((x+w)/8, y   /8))
 rd=fget(mget((x+w)/8,(y+h)/8))
 collide = (lu==f or ld==f or 
            ru==f or rd==f)
 return collide,lu,ld,ru,rd
end

function _update()

 gridx = x\8
 gridy = y\8

 dx,dy=0,0
 if (btn(⬆️)) dy=-1
 if (btn(⬇️)) dy=1
 if (btn(⬅️)) dx=-1
 if (btn(➡️)) dx=1
 
 h7x,_,_,_,_ = hita(x+dx,y,w,h,7)
 _,lu1,ld1,ru1,rd1=hita(x+dx,y,w,h)
 _, _ , _ ,ru2,rd2=hita(x+dx+dx,y,w,h)
 if (ru1==3 or rd1==3 or
     ld1==5 or h7x) then
  dx=0 end
 if (lu1==3 or ld1==3) and
    (ru2==3 or rd2==3) then
  dx=0 end

 h7y,_,_,_,_ = hita(x,y+dy,w,h,7)
 _,lu1,ld1,ru1,rd1=hita(x,y+dy,w,h)
 _, _ ,ld2, _ ,rd2=hita(x,y+dy+dy,w,h)
 if (ld1==5 or rd1==5 or 
     ru1==3 or h7y) then
  dy=0 end
 if (lu1==5 or ru1==5) and
    (ld2==5 or rd2==5) then
  dy=0 end


 x+=dx y+=dy
 
end


function _draw()
 cls()
 map()
 spr(0,x,y)

 print(gridx..','..gridy)
 print(lu..','..ld..','..
       ru..','..rd)
end
__gfx__
80000009000000006000000070000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006000000070000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000006000000070000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000006000000070000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000006000000070000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000006000000070000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006000000070000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
b000000a000000006000000070000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666677777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000030300070700000000000000000000070505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112121212121211121212121211000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000002000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000002000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201000000000003000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000002000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112121212120111121212121211000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
